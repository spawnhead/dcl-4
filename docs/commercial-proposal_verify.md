# Verify: commercial-proposal

## Legacy → New static mapping
- Legacy source reviewed: `Action/DAO/sql-resources` entries for commercial proposal insert/filter/close-reserve flow.
- New source reviewed: `CommercialProposalController` + `CommercialProposalService` + `V003/V004/V005` functions.

## Pseudo-tests (input → expected)
1. `POST /commercial-proposal` with `action=save`, `id=CPR-001`
   - Expected: row inserted in `dcl_commercial_proposal` via `dcl_commercial_proposal_insert`.
   - Expected: `dcl_close_reserved_in_cpr` updates pending rows to `cpr_block=1`, `cpr_no_reservation=1`.
   - Expected UI markers: `Saved`, `Generated ID`, `Filter rows`.
2. `POST /commercial-proposal` with non-save action
   - Expected: no insert path executed, DTO echoed.
3. Filter parity check
   - Compare `dcl_commercial_proposal_filter('CPR-001',...)` result with direct select by number.

## Output parity notes
- IDs generated by DB function, not in controller.
- Functional parity target maintained for insert/filter/close reserve chain.
